#
# To be run in the offline machine. Looks for all PIONIER and GRAVITY oidata
# and copies them into a time-stamped directory in "/diska/home/astrov/naomi/JPB/"
#
import os
import shutil
import datetime
import glob as glob

dt = datetime.datetime.now()

dirid = "{}_{}_{}_{}:{}:{}".format(dt.year, dt.month, dt.day,dt.hour,dt.minute,dt.second)

# Creating the storage directory
# caution hardcoded dates remember to update them
datestart = "2018_09_23"
dateend = "2018_11_08"
homedir    = "/diska/home/astrov/naomi/JPB/"
oialldir = "oifits_from_{}_to_{}_stamp_{}".format(datestart, dateend, dirid)
storagedir = homedir + oialldir
os.mkdir(storagedir )


datadir = "/data-vlti/reduced/"
listdir = glob.glob(datadir + "/2018*")
# WARNING: adjust by end the number of directory explored listdir[16:]
for ddir in listdir[16:]: 
    abcddir = glob.glob(ddir+"/pionier_reduced/*abcd")
    grvoifiles = glob.glob(ddir + "/gravity_reduced/*singlescivis.fits")
    if len(abcddir):
        pnroifiles = glob.glob(abcddir[0]+"/*FRINGE*_oidata.fits")
    
    # testing the presence of gravity files
    if len(grvoifiles):
        for oifile in grvoifiles:
            shutil.copy(oifile, storagedir)
    if len(pnroifiles):
        for oifile in pnroifiles:
            shutil.copy(oifile, storagedir)

