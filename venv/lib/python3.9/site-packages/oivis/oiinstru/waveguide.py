### functions related to the use of waveguides
import numpy as np
from scipy import constants

def dispersed_phase_foresto(sigma0, sigma, length1, deltalength, d2, deltaD):
    '''dispersed_phase_foresto(sigma0, sigma, length1, deltalength, d2, deltaD)
    
    Uses Foresto et al. 1995 dispersion formula to compute the phase 
    at each wavenumber sigma after propagation in a two beam fibered interferometers 
    with arms of length length1 and length1 + deltalength and dispersion
    coefficients d1-deltaD and d2

    :param sigma0: reference wavenumber (meters**-1)
    :type sigma0: float
    :param sigma: wavenumber (meters**-1)
    :type sigma: array of floats
    :param length1: length of path 1 (meters)
    :type length1: float
    :param deltalength: different between path 1 and 2 (meters)
    :type deltalength: float
    :param d2: dispersion coefficient of fiber 2
    :type d2: float
    :param deltaD: difference between dispersion constants
    :type deltaD: float

    :return: dispersedphase
    '''
    dispcoeff = d2 * deltalength + length1 * deltaD
    d2Phidsigma2 = 2 * np.pi * constants.c * dispcoeff / sigma**2
    return -1 * d2Phidsigma2 * (sigma - sigma0)**2 / 2